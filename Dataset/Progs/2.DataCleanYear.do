//////////////////////////////////////////////////////////////////////////////////////////////
//title: Data cleaning
//author: JÃºlio Teixeira
//date: 08/03/2024
//objective: In this do-file we perform some cleaning of the data that we will use, in addition to merging the yearly information into a single dataset.
************************************************************************************************
//To make sure the code runs smoothly
clear all
capture log close
program drop _all
set more off
*version 18
************************************************************************************************

//////////////////////////////////////////////
//Define the main path (insert the directory corresponding to the user here)
global path1 "C:/Users/julio/Desktop/Dataset"
adopath ++ "${path1}/Progs/Ado"
//////////////////////////////////////////////

*Step 1: Changing the working directory, and starting the log
cd "${path1}"
log using "./Logs/Datasets_Cleaning", replace

**installs needed: net install standardizetext, from("https://github.com/BPLIM/Tools/raw/master/ados/General/standardizetext/") //To easily standardize the variables, and use it on standardtextcontr

*Step 2: Database cleaning
*************************************************************************************************
//From now on the code is divided between years. We start with the most recent year and go until the oldest available. The information is divided between different Excel sheets for each year, so there is a need to treat them separately. It should be noted that within the ADOs we have a brief explanation of each code used.
*************************************************************************************************

**********
**22/23**
**********

********** Contract related data **********
use "${path1}/Data/Contract_Source_STATA/Contract_2022", clear

standardtextcontr //Standardizing the variables (text inside the observations).

treatm //To clean up the variables (creating the dummy "CONVIDADO"; standardizing the Classhours variable; obtaining the years of service; etc).

categclean //In order to standardize and select the categories that we want to use.

//To get the organic units location (only works for the four last years of the dataset)
merge m:1 Organic_Unit_Code using "${path1}/Data/Establishments_Location_Tidy", keepus(District NUTS2)
drop if _merge==2
drop _merge

labelcontr // We created a unique label for all variables, so that it is possible to understand more simply what they are about.

save "${path1}/Data/Contract_Data_Tidy/Contract_2022", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2022", clear

standardtextdgr //Standardizing the variables.

hidegr //To ensure we only have the highest grade of the professor.

treatm1 //To clean up the variables.

labeldegr // We created a unique label for all variables, so that it is possible to understand more simply what they are about.

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2022", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2022"
merge m:1 idrh_ieesp idrh_iecdes using "${path1}\Data\Degree_Data_Tidy\HighDegree_2022", keepusing(Degree_Country_Code Degree_Year CNAEF_area Degree GenArea) keep(match master)
drop _merge

save "${path1}\Data\Merged_Data\Merged_Data_2022", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**21/22**
**********

********** Contract related data **********
use "${path1}/Data/Contract_Source_STATA/Contract_2021", clear

standardtextcontr

treatm

categclean

merge m:1 Organic_Unit_Code using "${path1}/Data/Establishments_Location_Tidy", keepus(District NUTS2)
drop if _merge==2
drop _merge

save "${path1}/Data/Contract_Data_Tidy/Contract_2021", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2021", clear

standardtextdgr

hidegr

treatm1

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2021", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2021"
merge m:1 idrh_ieesp idrh_iecdes using "${path1}\Data\Degree_Data_Tidy\HighDegree_2021", keepusing(Degree_Country_Code Degree_Year CNAEF_area Degree GenArea) keep(match master)
drop _merge

save "${path1}\Data\Merged_Data\Merged_Data_2021", replace 


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


**********
**20/21**
**********

********** Contract related data **********
use "${path1}/Data/Contract_Source_STATA/Contract_2020", clear

standardtextcontr

treatm

categclean

merge m:1 Organic_Unit_Code using "${path1}/Data/Establishments_Location_Tidy", keepus(District NUTS2)
drop if _merge==2
drop _merge

save "${path1}/Data/Contract_Data_Tidy/Contract_2020", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2020", clear

standardtextdgr

hidegr

treatm1

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2020", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2020"
merge m:1 idrh_ieesp idrh_iecdes using "${path1}\Data\Degree_Data_Tidy\HighDegree_2020", keepusing(Degree_Country_Code Degree_Year CNAEF_area Degree GenArea) keep(match master)
drop _merge

save "${path1}\Data\Merged_Data\Merged_Data_2020", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**19/20**
**********

********** Contract and Activities related data ********** 
use "${path1}/Data/Contract_Source_STATA/Contract_2019", clear

standardtextcontr

treatm

categclean

merge m:1 Organic_Unit_Code using "${path1}/Data/Establishments_Location_Tidy", keepus(District NUTS2)
drop if _merge==2
drop _merge

save "${path1}/Data/Contract_Data_Tidy/Contract_2019", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2019", clear

standardtextdgr

hidegr

treatm1

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2019", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2019"
merge m:1 idrh_ieesp idrh_iecdes using "${path1}\Data\Degree_Data_Tidy\HighDegree_2019", keepusing(Degree_Country_Code Degree_Year CNAEF_area Degree GenArea) keep(match master)
drop _merge

save "${path1}\Data\Merged_Data\Merged_Data_2019", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


**********
**18/19**
**********

********** Contract related data ********** 
use "${path1}/Data/Contract_Source_STATA/Contract_2018", clear

standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2018", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2018", clear

standardtextdgr

hidegr1

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2018", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2018"
merge m:1 iddocente idrh using "${path1}\Data\Degree_Data_Tidy\HighDegree_2018", keepusing(Degree) keep(match master)
drop _merge
destring iddocente, replace

save "${path1}\Data\Merged_Data\Merged_Data_2018", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**17/18**
**********

********** Contract related data ********** 
use "${path1}/Data/Contract_Source_STATA/Contract_2017", clear

standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2017", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2017", clear

standardtextdgr

hidegr1

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2017", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2017"
merge m:1 iddocente idrh using "${path1}\Data\Degree_Data_Tidy\HighDegree_2017", keepusing(Degree) keep(match master)
drop _merge
destring iddocente, replace
save "${path1}\Data\Merged_Data\Merged_Data_2017", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**16/17**
**********

********** Contract related data ********** 
use "${path1}/Data/Contract_Source_STATA/Contract_2016", clear

standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2016", replace

********** Degree related data  **********
use "${path1}/Data/Degree_Source_STATA/Degree_2016", clear

standardtextdgr

hidegr1

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2016", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2016"
merge m:1 iddocente idrh using "${path1}\Data\Degree_Data_Tidy\HighDegree_2016", keepusing(Degree) keep(match master)
drop _merge
order iddocente idrh
destring iddocente, replace
save "${path1}\Data\Merged_Data\Merged_Data_2016", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**15/16**
**********

********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2015", clear
 
standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2015", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2015", clear

standardtextdgr

hidegr2

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2015", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2015"
merge m:1 iddocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2015", keepusing(Degree) keep(match master)
drop _merge
destring iddocente, replace
save "${path1}\Data\Merged_Data\Merged_Data_2015", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**14/15**
**********

********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2014", clear

standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2014", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2014", clear

standardtextdgr

hidegr2

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2014", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2014"
merge m:1 iddocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2014", keepusing(Degree) keep(match master)
drop _merge
destring iddocente, replace

save "${path1}\Data\Merged_Data\Merged_Data_2014", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**13/14**
**********

********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2013", clear
 
standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2013", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2013", clear

standardtextdgr

hidegr2

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2013", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2013"
merge m:1 iddocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2013", keepusing(Degree) keep(match master)
drop _merge
destring iddocente, replace
save "${path1}\Data\Merged_Data\Merged_Data_2013", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**12/13**
**********

********** Contract related data **********   
use "${path1}/Data/Contract_Source_STATA/Contract_2012", clear

standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2012", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2012", clear

standardtextdgr

hidegr3

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2012", replace


********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2012"
merge m:1 numdocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2012", keepusing(Degree) keep(match master)
drop _merge
save "${path1}\Data\Merged_Data\Merged_Data_2012", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**11/12**
**********

********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2011", clear

standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2011", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2011", clear

standardtextdgr

hidegr3

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2011", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2011"
merge m:1 numdocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2011", keepusing(Degree) keep(match master)
drop _merge
save "${path1}\Data\Merged_Data\Merged_Data_2011", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**10/11**
**********

********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2010", clear
 
standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2010", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2010", clear

standardtextdgr

hidegr3

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2010", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2010"
merge m:1 numdocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2010", keepusing(Degree) keep(match master)
drop _merge
save "${path1}\Data\Merged_Data\Merged_Data_2010", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**09/10**
**********

********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2009", clear

standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2009", replace


********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2009", clear

standardtextdgr

hidegr3

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2009", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2009"
merge m:1 numdocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2009", keepusing(Degree) keep(match master)
drop _merge

save "${path1}\Data\Merged_Data\Merged_Data_2009", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**08/09**
**********

********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2008", clear
 
standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2008", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2008", clear

standardtextdgr

hidegr3

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2008", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2008"
merge m:1 numdocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2008", keepusing(Degree) keep(match master)
drop _merge

save "${path1}\Data\Merged_Data\Merged_Data_2008", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**07/08**
**********
 
********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2007", clear
 
standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2007", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2007", clear

standardtextdgr

hidegr3

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2007", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2007"
merge m:1 numdocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2007", keepusing(Degree) keep(match master)
drop _merge

save "${path1}\Data\Merged_Data\Merged_Data_2007", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**06/07**
**********

********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2006", clear

standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2006", replace


********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2006", clear

standardtextdgr

hidegr3

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2006", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2006"
merge m:1 numdocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2006", keepusing(Degree) keep(match master)
drop if _merge==1
drop _merge
save "${path1}\Data\Merged_Data\Merged_Data_2006", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**05/06**
**********

********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2005", clear

standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2005", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2005", clear

standardtextdgr

hidegr3

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2005", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2005"
merge m:1 numdocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2005", keepusing(Degree) keep(match master)
drop _merge

save "${path1}\Data\Merged_Data\Merged_Data_2005", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**04/05**
**********

********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2004", clear
 
standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2004", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2004", clear

standardtextdgr

hidegr3

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2004", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2004"
merge m:1 numdocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2004", keepusing(Degree) keep(match master)
drop _merge

save "${path1}\Data\Merged_Data\Merged_Data_2004", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**03/04**
**********

********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2003", clear

standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2003", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2003", clear

standardtextdgr

hidegr3

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2003", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2003"
merge m:1 numdocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2003", keepusing(Degree) keep(match master)
drop _merge
save "${path1}\Data\Merged_Data\Merged_Data_2003", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**02/03**
**********

********** Contract related data **********  
use "${path1}/Data/Contract_Source_STATA/Contract_2002", clear

standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2002", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2002", clear

standardtextdgr

hidegr3

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2002", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2002"
merge m:1 numdocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2002", keepusing(Degree) keep(match master)
drop _merge

save "${path1}\Data\Merged_Data\Merged_Data_2002", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

**********
**01/02**
**********

********** Contract related data **********   
use "${path1}/Data/Contract_Source_STATA/Contract_2001", clear

standardtextcontr

treatm2

categclean

save "${path1}/Data/Contract_Data_Tidy/Contract_2001", replace

********** Degree related data **********
use "${path1}/Data/Degree_Source_STATA/Degree_2001", clear

standardtextdgr

hidegr3

save "${path1}/Data/Degree_Data_Tidy/HighDegree_2001", replace

********** Merging **********  
clear all
use "${path1}/Data/Contract_Data_Tidy/Contract_2001"
merge m:1 numdocente using "${path1}\Data\Degree_Data_Tidy\HighDegree_2001", keepusing(Degree) keep(match master)
drop _merge

save "${path1}\Data\Merged_Data\Merged_Data_2001", replace 

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

log close
